# 22장 클린 아키텍처

- 아키텍처의 여러 아이디어
  - 육각형 아키텍처 (Hexagonal Architecture, Port & Adapter)
  - DCI(Data, Context and Interaction)
  - BCE(Boundary-Control-Entity)
- 여러 아키텍처의 공통적인 목표는 결국 관심사의 분리(separation of concerns)다.
- 아키텍처는 시스템이 다음과 같은 특징을 지니도록 만든다.
  - 프레임워크 독립성 : 프레임워크를 도구로 사용할 수 있으며, 프레임워크가 지닌 제약사항 안으로 시스템을 욱여 넣도록 강제하지 않는다.
  - 테스트 용이성 : 업무 규칙은 UI, 데이터베이스, 웹 서버, 여탸 외부 요소가 없이도 테스트할 수 있다.
  - UI 독립성 : 시스템의 나머지 부분을 변경하지 않고도 UI를 쉽게 변경할 수 있다.
  - 데이터베이스 독립성 : 오라클, MS SQL, 몽고DB 등으로 교체할 수 있다. 업무 규칙은 데이터베이스에 결합되지 않는다.
  - 모든 외부 에이전시에 대한 독립성 : 실제로 업무 규칙은 외부 세계화의 인터페이스에 대해 전혀 알지 못한다.

![chapter22-1.png](images/chapter22-1.png)

### 의존성 규칙

- 소스 코드 의존성은 반드시 안쪽으로, 고수준의 정책을 향해야 한다.
- 내부의 원에 속한 요소는 외부에 원에 속한 어떤 것에 대해서도 몰라야 한다.
  - 함수, 클래스, 변수, 소프트웨어 엔티티, 데이터 형식 등
- 외부의 원에 선언된 데이터 형식도 내부의 원에서 절대로 사용해서는 안된다.
  - 특히 프레임워크가 생성한 것이라면 더더욱 사용해서는 안된다.
- 외부 원에 위치한 어떤 것도 내부의 원에 영향을 주지 않기를 바란다.



### 엔티티

- 핵심 업무 규칙을 캡슐화한다.
- 엔티티는 메서드를 가지는 객체이거나 일련의 데이터 구조와 함수의 집합일 수도 있다.
  - 기업의 다양한 애플리케이션에서 엔티티를 재사용할 수만 있다면, 그 형태는 그다지 중요하지 않다.
- 운영 관점에서 특정 애플리케이션에 변경이 필요하더라도 엔티티 계층은 영향을 주면 안된다.
  - 외부의 무언가가 변경되더라도 엔티티가 변경될 가능성은 지극히 낮다.



### 유스케이스

- 애플리케이션에 특화된 업무 규칙을 포함한다.
- 유스케이스는 엔티티로 들어오고 나가는 데이터 흐름을 조정한다.
  - 엔티티가 자신의 핵심 업무 규칙을 사용해서 유스케이스의 목적을 달성하도록 이끈다.
- 운영 관점에서 애플리케이션이 변경된다면 유스케이스가 영향을 받는다.



### 인터페이스 어댑터

- 유스케이스와 엔티티에게 편리한 형식에서 외부 에이전시에게 편리한 형식으로 변환한다.
  - ''엔티티, 유스케이스'와  '프레임워크, 데이터베이스' 사이의 데이터 형식을 변환해준다.
  - 또는 외부 서비스와 같은 외부적인 형식에서 내부적인 형식으로 변환해준다.
- EX) MVC 아키텍처의 프레젠터, 뷰, 컨트롤러



### 프레임워크와 드라이버

- 모든 세부사항이 위치한 곳이다.
  - 웹, 데이터베이스 등
- 안쪽 원과 통신하기 위한 접합 코드 외에는 특별히 더 작성해야 할 코드가 많지 않다.



## 원은 네 개여야만 하나?

- 항상 네 개만 사용한다는 규칙은 없다. 더 많은 원이 필요할 수도 있다.
- 하지만 어떤 경우에도 의존성 규칙은 적용된다.
  - 소스 코드 의존성은 항상 안쪽을 향한다.
  - 안쪽으로 이동할수록 추상화와 정책의 수준이 높아진다.



## 경계 횡단하기

- 제어 흐름 : 컨트롤러 → **유스케이스 → 프레젠터**
- 소스 코드 의존성 : 컨트롤러, **프레젠터 → 유스케이스**
- 유스케이스에서 프레젠터를 직접 호출하면 DIP 위반이다.
  - 내부위 원은 외부 원에 있는 어떤 이름도 언급하면 안 된다.
- 구현 클래스를 직접 참조하는 것이 아니라, 상위 요소(추상 클래스, 인터페이스)를 참조해야 한다.

![chapter22-2.png](images/chapter22-2.png)



## 경계를 횡단하는 데이터

- 경계를 가로지르는 데이터는 흔히 간단한 데이터 구조로 이루어져 있다.

  - 기본적인 구조체, DTO(Data Transfer Object)

- 함수를 호출할 때 인자로 데이터를 전달하거나 데이터를 해시맵으로 묶거나 객체로 구성할 수도 있다.

- 엔티티 객체나 데이터베이스의 행(row)을 전달하는 일은 부적절하다.

  - 데이터 구조가 의존성을 갖게 해서는 안 된다.

- cf. 데이터 구조

  - DAO(Data Access Object) : DB에 접근하기 위한 객체
  - DTO(Data Transfer Object) : 계층 간 데이터 교환을 위한 객체(Getter, Setter 존재)
  - VO(Value Object) : 단순 값 오브젝트(Getter만 존재, read-only)

  