## 28장 테스트 경계

테스트에는 굉장히 여러 종류가 있지만, 아키텍처 관점에서는 모든 테스트가 동일하다.

테스트는 태생적으로 테스트 대상이 되는 코드를 의존한다.

테스트는 시스템 컴포넌트 중 가장 고립되어 있고, 운영에 꼭 필요치는 않다.

그럼에도, **테스트가 시스템 컴포넌트가 아니라는 뜻은 아니다.**

### 테스트를 고려한 설계

테스트는 대체로 배포하지 않는다고 생각하고, 개발자는 종종 테스트가 시스템의 설계 범위 밖에 있다고 여김

➡️ 굉장히 치명적인 관점이다.

테스트가 시스템의 설계와 통합되지 않으면, 테스트는 깨지기 쉬워지고 시스템은 변경하기 어려워진다.

시스템에 강하게 결합된 테스트라면, 시스템의 공통 컴포넌트가 변경되면 수백,

수천개의 테스트가 망가진다. 이를 두고 **깨지기 쉬운 테스트 문제**라고 한다.

#### **소프트웨어 설계의 첫 번째 규칙!**

> 변동성이 있는 것에 의존하지 말라.

예를 들어 GUI에 의존하는 테스트라면, 깨지기 쉽다.

GUI는 변동성이 매우 크기 때문이다.

따라서 시스템과 테스트를 설계할 때, 이를 잘 고려해서 설계해야 한다.

### 테스트 API

위의 목표를 달성하려면

-   값비싼 자원(DB)은 건너뛰고
-   보안 제약사항은 무시하며
-   모든 업무 규칙을 검증할 수 있는 API를 만들면된다.

테스트 API는 테스트를 애플리케이션으로부터 분리할 목적으로 사용된다.

#### 구조적 결합

> 상용 코드란? 수정하지 않거나 최소한의 수정만을 거쳐 여러 곳에 필수적으로 사용되는 코드를 말한다.

구조적 결합은 테스트 결합 중에서 가장 강하며 상용 클래스나 메서드 중 하나라도 변경되면

다수의 테스트가 변경되어야 한다.

테스트 API의 역할은 애플리케이션의 구조를 테스트로부터 숨겨 상용 코드를 리팩터링 하거나 진화시키더라도  
테스트에는 전혀 영향을 주지 않는것에 있다. (반대도 마찬가지이다.)

구조적 결합을 약하게하여

-   시간이 지날수록 테스트는 더 구체적이고 특화된형태로 변화되어야한다.
-   상용 코드는 더 추상적이고 범용적인 형태로 변화해야함.

#### 보안

하지만 보안적인 측면에서는 테스트 API 자체와 테스트 API 중 위험한 부분의 구현부는 독립적인 컴포넌트로

분리해야 한다.

### 결론

테스트는 시스템의 일부다.

테스트를 시스템의 일부로 설계하지 않으면, 테스트는 깨지기 쉽고 유지보수하기 어려워지는 경향이 있다.

테스트가 유지보수가 어렵다면 결국 버려지는 최후를 맞게 된다.
